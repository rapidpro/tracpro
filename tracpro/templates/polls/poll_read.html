{% extends "smartmin/base.html" %}
{% load smartmin i18n %}

{% block pre-content %}

  {% include 'polls/poll_header.html' with poll=object %}

{% endblock %}

{% block content %}
  <div>
    {% if not request.region %}
      {% trans "Charts only include data from non-regional poll runs" %}

    {% endif %}
    <div class='pull-away'>
      <form class='form-inline' method='get'>
        <label class='control-label' for='window-select'></label>
        {% trans "Show" %}
        <select id='value-type-select' class='form-control' onchange='onChartChange(this)' name='value_type'>
          {% for value_type in value_type_options %}
            {% if value_type == value_type_selected %}
              <option selected='selected' value='{{ value_type }}'>
                {{ value_type }}
              </option>
            {% else %}
              <option value='{{ value_type }}'>
                {{ value_type }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
        <select id='window-select' class='form-control' onchange='onChartChange(this)' name='window'>
          {% for win in window_options %}
            {% if win == window %}
              <option selected='selected' value='{{ win.name }}'>
                {{ win.label }}
              </option>
            {% else %}
              <option value='{{ win.name }}'>
                {{ win.label }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
      </form>
    </div>
  </div>
  {% for question in questions %}
    <h3>
      {{ question.order }}. {{ question.text }}

    </h3>

    <div id='chart_{{ question.pk }}' class='chart' data-window-max='{{ window_max }}' data-window-min='{{ window_min }}' ></div>
    <script>
      $(function () {
        $('#chart_{{ question.pk }}').highcharts({
            title: {
                text: '{{ question.text }}'
            },
            xAxis: {
              categories: [
                          {% for date in question.date_list %}
                            '{{ date }}'{% if not forloop.last %},{% endif %}
                          {% endfor %}
                          ]
            },
            series: [
                {
                type: 'area',
                name: '{{ question.text }}',
                {% if value_type_selected|lower ==  "sum" %}
                  data: {{ question.answer_sum_list }}
                {% elif value_type_selected|lower ==  "average" %}
                  data: {{ question.answer_average_list }}
                {% endif %}
              }
            ]
        });
    });
    </script>

  {% endfor %}
{% endblock %}
{% block extra-script %}
<script type='text/javascript'>
// <![CDATA[
    function onChartChange(ctrl) {
      ctrl.form.submit();
    }
// ]]>
</script>
{% endblock %}
